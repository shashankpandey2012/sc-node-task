{"version":3,"sources":["../../controllers/UserController.js"],"names":["login","req","res","body","user_id","undefined","password","log","user","verify","password_hash","token","sign","secret","algorithm","issuer","subject","expiresIn"],"mappings":";;;;;;AAGA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;;;AAEA;;;;kBAIe;;AAEX;;;;AAIAA,WAAQ,eAACC,GAAD,EAAKC,GAAL,EAAW;;AAEf,YAAGD,IAAIE,IAAJ,CAASC,OAAT,KAAqBC,SAArB,IAAkCJ,IAAIE,IAAJ,CAASG,QAAT,KAAsBD,SAA3D,EAAqE;AACjE,6BAAOE,GAAP,CAAW,OAAX,EAAoB,6BAApB;AACA,uCAAYL,GAAZ,EAAkB,IAAlB,EAAwB,WAAxB,EAAsC,GAAtC;AACH,SAHD,MAII;AACA,gBAAIE,UAAUH,IAAIE,IAAJ,CAASC,OAAvB;AACA,gBAAIE,WAAWL,IAAIE,IAAJ,CAASG,QAAxB;AACA,gBAAIE,OAAO,uCAAiB,EAACJ,SAAUA,OAAX,EAAjB,CAAX;AACA,gBAAGI,IAAH,EAAQ;AACJ,oBAAG,uBAAaC,MAAb,CAAoBH,QAApB,EAA+BE,KAAKE,aAApC,CAAH,EAAsD;AAClD,wBAAIC,QAAQ,uBAAIC,IAAJ,CAAS,EAAT,EAAa,qBAAWC,MAAxB,EAAiC,EAACC,WAAY,OAAb,EAAwBC,QAAS,qBAAWA,MAA5C,EAAqDC,SAAUZ,OAA/D,EAAyEa,WAAU,OAAnF,EAAjC,CAAZ;AACA,qCAAOV,GAAP,CAAW,MAAX,EAAmB,wBAAnB;AACA,+CAAYL,GAAZ,EAAkB,EAACE,SAAUA,OAAX,EAAqBO,OAAQA,KAA7B,EAAlB,EAAwD,IAAxD,EAA+D,GAA/D;AACH,iBAJD,MAKI;AACA,qCAAOJ,GAAP,CAAW,OAAX,EAAoB,mBAApB;AACA,+CAAYL,GAAZ,EAAiB,IAAjB,EAAuB,4BAAvB,EAAsD,GAAtD;AACH;AACJ,aAVD,MAWI;AACA,iCAAOK,GAAP,CAAW,OAAX,EAAoB,gBAApB;AACA,2CAAYL,GAAZ,EAAiB,IAAjB,EAAuB,4BAAvB,EAAsD,GAAtD;AACH;AACJ;AAGJ;AAlCU,C,EAff","file":"UserController.js","sourcesContent":["/**\r\n * Created by Shashank on 5/4/2017.\r\n */\r\nimport jwt from 'jsonwebtoken';\r\nimport passwordHash from 'password-hash';\r\nimport user_data from '../data/users';\r\nimport logger from '../logger';\r\nimport privateKey from '../utility/PrivateKey';\r\nimport { find } from 'lodash/collection';\r\nimport APIResponse from './APIResponse';\r\n\r\n/**\r\n * UserController.js\r\n* */\r\n\r\nexport default {\r\n\r\n    /**\r\n     * UserController.login(req,res)\r\n     * Controller Function for Login\r\n     * */\r\n    login : (req,res)=>{\r\n\r\n        if(req.body.user_id === undefined || req.body.password === undefined){\r\n            logger.log('error', 'MISSING USER ID OR PASSWORD');\r\n            APIResponse(res , null, 'FORBIDDEN' , 403);\r\n        }\r\n        else{\r\n            let user_id = req.body.user_id;\r\n            let password = req.body.password;\r\n            let user = find(user_data , {user_id : user_id});\r\n            if(user){\r\n                if(passwordHash.verify(password , user.password_hash)){\r\n                    let token = jwt.sign({} ,privateKey.secret , {algorithm : 'HS512' ,  issuer : privateKey.issuer , subject : user_id , expiresIn:5184000} );\r\n                    logger.log('info', 'Logged In Successfully');\r\n                    APIResponse(res , {user_id : user_id , token : token} , 'OK' , 200);\r\n                }\r\n                else{\r\n                    logger.log('error', 'WRONG CREDENTIALS');\r\n                    APIResponse(res, null, 'Invalid UserId or Password' , 403);\r\n                }\r\n            }\r\n            else{\r\n                logger.log('error', 'USER NOT FOUND');\r\n                APIResponse(res, null, 'Invalid UserId or Password' , 403);\r\n            }\r\n        }\r\n\r\n\r\n    }\r\n};"]}