{"version":3,"sources":["../../utility/Secured.js"],"names":["api_auth","req","res","next","token","header","decoded","verify","secret","issuer","user","user_id","sub","log","status","json","data","message","err"],"mappings":";;;;;;AAGA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA,IAAIA,WAAW,SAAXA,QAAW,CAACC,GAAD,EAAOC,GAAP,EAAaC,IAAb,EAAoB;AAC/B,QAAIC,QAAQH,IAAII,MAAJ,CAAW,eAAX,CAAZ;AACA,QAAGD,KAAH,EAAS;;AAEL,YAAI;AACA,gBAAIE,UAAU,uBAAIC,MAAJ,CAAWH,KAAX,EAAkB,qBAAWI,MAA7B,EAAsC,EAACC,QAAS,qBAAWA,MAArB,EAAtC,CAAd;AACA,gBAAIC,OAAO,uCAAiB,EAAEC,SAAUL,QAAQM,GAApB,EAAjB,CAAX;AACA,gBAAGF,IAAH,EAAQ;AACJ,iCAAOG,GAAP,CAAW,MAAX,EAAoB,QAApB;AACAZ,oBAAIK,OAAJ,GAAcI,IAAd;AACAP;AACH,aAJD,MAKI;AACA,iCAAOU,GAAP,CAAW,OAAX,EAAqB,gBAArB;AACA,uBAAOX,IAAIY,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACxBC,0BAAO,IADiB;AAExBC,6BAAS,6BAFe;AAGxBH,4BAAQ;AAHgB,iBAArB,CAAP;AAKH;AAEJ,SAjBD,CAiBE,OAAMI,GAAN,EAAW;AACT;AACA,6BAAOL,GAAP,CAAW,OAAX,EAAqBK,GAArB;AACA,mBAAOhB,IAAIY,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACxBC,sBAAM,IADkB;AAExBC,yBAAS,WAFe;AAGxBH,wBAAS;AAHe,aAArB,CAAP;AAKH;AACJ,KA5BD,MA6BK;AACD;AACA;AACA,yBAAOD,GAAP,CAAW,OAAX,EAAqB,gBAArB;AACA,eAAOX,IAAIY,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACxBC,kBAAM,IADkB;AAExBC,qBAAS,WAFe;AAGxBH,oBAAS;AAHe,SAArB,CAAP;AAKH;AACJ,CAzCD,C,CATA;;;kBAoDed,Q","file":"Secured.js","sourcesContent":["/**\r\n * Created by Shashank on 5/4/2017.\r\n */\r\nimport jwt from 'jsonwebtoken';\r\nimport PrivateKey from './PrivateKey';\r\nimport user_data from '../data/users';\r\nimport logger from '../logger';\r\nimport { find } from 'lodash/collection';\r\n\r\nlet api_auth = (req , res , next)=>{\r\n    let token = req.header('Authorization');\r\n    if(token){\r\n\r\n        try {\r\n            let decoded = jwt.verify(token, PrivateKey.secret , {issuer : PrivateKey.issuer } );\r\n            let user = find(user_data , { user_id : decoded.sub });\r\n            if(user){\r\n                logger.log('info' , 'INSIDE');\r\n                req.decoded = user;\r\n                next();\r\n            }\r\n            else{\r\n                logger.log('error' , 'USER NOT FOUND');\r\n                return res.status(403).json({\r\n                    data : null,\r\n                    message: 'Invalid LoginId or Password',\r\n                    status: 403\r\n                });\r\n            }\r\n\r\n        } catch(err) {\r\n            // err\r\n            logger.log('error' , err);\r\n            return res.status(403).json({\r\n                data: null,\r\n                message: 'FORBIDDEN',\r\n                status : 403\r\n            });\r\n        }\r\n    }\r\n    else {\r\n        // if there is no token\r\n        // return an error\r\n        logger.log('error' , 'NO TOKEN FOUND');\r\n        return res.status(403).json({\r\n            data: null,\r\n            message: 'FORBIDDEN',\r\n            status : 403\r\n        });\r\n    }\r\n};\r\n\r\nexport default api_auth;\r\n\r\n\r\n\r\n\r\n"]}